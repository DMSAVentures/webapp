@use "@/design-tokens/layout" as layout;
@use "@/design-tokens/typography" as typography;
@use "@/design-tokens/motion" as motion;
@use "@/design-tokens/border" as border;

.root {
	display: flex;
	flex-direction: column;
	height: 100%;
	background-color: var(--color-surface-primary-default);
	border-radius: border.$border-radius-medium;
	overflow: hidden;
}

// Header
.header {
	display: flex;
	align-items: center;
	justify-content: space-between;
	gap: layout.$spacing-04;
	padding: layout.$spacing-05;
	background-color: var(--color-surface-primary-default);
	border-bottom: border.$border-width-small solid var(--color-border-primary-default);
}

.headerContent {
	display: flex;
	align-items: center;
	gap: layout.$spacing-04;
	flex: 1;
}

.title {
	margin: 0;
	font-size: typography.$font-size-xl;
	font-weight: typography.$font-weight-semibold;
	color: var(--color-text-primary-default);
}

.headerActions {
	display: flex;
	align-items: center;
	gap: layout.$spacing-03;
}

.deviceSelector {
	display: flex;
	align-items: center;
	gap: layout.$spacing-02;
	padding: layout.$spacing-02;
	background-color: var(--color-bg-secondary-default);
	border-radius: border.$border-radius-medium;
}

.testEmailForm {
	display: flex;
	align-items: center;
	gap: layout.$spacing-02;
}

.testEmailInput {
	width: 200px;
}

.successBanner {
	display: flex;
	align-items: center;
	justify-content: center;
	gap: layout.$spacing-02;
	padding: layout.$spacing-03;
	background-color: var(--color-bg-success-default);
	color: var(--color-text-inverse-default);
	font-size: typography.$font-size-sm;
	font-weight: typography.$font-weight-medium;

	i {
		font-size: typography.$font-size-md;
	}
}

// Mode Tabs
.modeTabs {
	flex-shrink: 0;
	padding: 0 layout.$spacing-05;
	background-color: var(--color-surface-primary-default);
	border-bottom: border.$border-width-small solid var(--color-border-primary-default);
}

// Builder layout (3-column)
.builder {
	display: grid;
	grid-template-columns: 260px 1fr 320px;
	grid-template-rows: 1fr;
	gap: layout.$spacing-04;
	flex: 1;
	min-height: 0; // Important for flex child with overflow
	overflow: hidden;
	padding: layout.$spacing-04;
	background-color: var(--color-bg-secondary-default);
}

// Panels
.leftPanel,
.rightPanel {
	background-color: var(--color-surface-primary-default);
	border: border.$border-width-small solid var(--color-border-primary-default);
	border-radius: border.$border-radius-medium;
	overflow-y: auto;
	min-height: 0; // Allow shrinking in grid
}

.centerPanel {
	display: flex;
	flex-direction: column;
	gap: layout.$spacing-04;
	overflow-y: auto;
	min-height: 0; // Allow shrinking in grid
}

.rightPanel {
	display: flex;
	flex-direction: column;
	overflow: hidden; // Contain content, child will scroll
}

// Panel mode toggle (Content vs Appearance)
.panelModeToggle {
	display: flex;
	gap: layout.$spacing-02;
	padding: layout.$spacing-04;
	border-bottom: border.$border-width-small solid var(--color-border-primary-default);
	flex-shrink: 0;
}

.panelModeButton {
	flex: 1;
	display: flex;
	align-items: center;
	justify-content: center;
	gap: layout.$spacing-02;
	padding: layout.$spacing-03 layout.$spacing-03;
	font-size: typography.$font-size-sm;
	font-weight: typography.$font-weight-medium;
	color: var(--color-text-secondary-default);
	background-color: var(--color-surface-primary-default);
	border: border.$border-width-small solid var(--color-border-primary-default);
	border-radius: border.$border-radius-medium;
	cursor: pointer;
	transition: all motion.$duration-fast-01 motion.$easing-productive-standard;

	i {
		font-size: typography.$font-size-md;
	}

	&:hover {
		background-color: var(--color-bg-secondary-hover);
		border-color: var(--color-border-primary-hover);
		color: var(--color-text-primary-default);
	}

	&.active {
		background-color: var(--color-bg-info-alpha);
		border-color: var(--color-border-focus-default);
		color: var(--color-text-primary-default);

		i {
			color: var(--color-info-default);
		}
	}

	&:focus-visible {
		outline: border.$border-width-medium solid var(--color-focus-ring-default);
		outline-offset: layout.$spacing-01;
	}
}

// Subject editor
.subjectEditor {
	background-color: var(--color-surface-primary-default);
	border: border.$border-width-small solid var(--color-border-primary-default);
	border-radius: border.$border-radius-medium;
	padding: layout.$spacing-04;
}

// Canvas wrapper
.canvasWrapper {
	display: flex;
	flex-direction: column;
	flex-shrink: 0; // Don't shrink - height based on content
	background-color: var(--color-surface-primary-default);
	border: border.$border-width-small solid var(--color-border-primary-default);
	border-radius: border.$border-radius-medium;
	overflow: hidden;
}

.canvasHeader {
	display: flex;
	align-items: center;
	gap: layout.$spacing-02;
	padding: layout.$spacing-03 layout.$spacing-04;
	background-color: var(--color-surface-secondary-default);
	border-bottom: border.$border-width-small solid var(--color-border-primary-default);
	font-size: typography.$font-size-sm;
	font-weight: typography.$font-weight-medium;
	color: var(--color-text-secondary-default);

	i {
		font-size: typography.$font-size-md;
		color: var(--color-icon-secondary-default);
	}
}

.blockCount {
	margin-left: auto;
	font-size: typography.$font-size-xs;
	color: var(--color-text-tertiary-default);
}

.canvas {
	display: flex;
	flex-direction: column;
	gap: layout.$spacing-02;
	padding: layout.$spacing-04;
}

.emptyCanvas {
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	gap: layout.$spacing-03;
	padding: layout.$spacing-08;
	color: var(--color-text-tertiary-default);
	text-align: center;

	i {
		font-size: typography.$font-size-h1;
		opacity: 0.5;
	}

	p {
		margin: 0;
		font-size: typography.$font-size-sm;
	}
}

.loadingState {
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	gap: layout.$spacing-03;
	padding: layout.$spacing-08;
	color: var(--color-text-tertiary-default);
	text-align: center;
	flex: 1;

	i {
		font-size: typography.$font-size-h1;
		animation: spin 1s linear infinite;
	}

	p {
		margin: 0;
		font-size: typography.$font-size-sm;
	}
}

@keyframes spin {
	from {
		transform: rotate(0deg);
	}

	to {
		transform: rotate(360deg);
	}
}

// Preview section
.previewWrapper {
	display: flex;
	flex-direction: column;
	flex: 1; // Take remaining space to show full email preview
	min-height: 300px;
	background-color: var(--color-surface-primary-default);
	border: border.$border-width-small solid var(--color-border-primary-default);
	border-radius: border.$border-radius-medium;
	overflow: hidden;
}

.previewHeader {
	display: flex;
	align-items: center;
	gap: layout.$spacing-02;
	padding: layout.$spacing-03 layout.$spacing-04;
	background-color: var(--color-surface-secondary-default);
	border-bottom: border.$border-width-small solid var(--color-border-primary-default);
	font-size: typography.$font-size-sm;
	font-weight: typography.$font-weight-medium;
	color: var(--color-text-secondary-default);

	i {
		font-size: typography.$font-size-md;
		color: var(--color-icon-secondary-default);
	}
}

.emailPreview {
	display: flex;
	flex-direction: column;
	margin: layout.$spacing-04 auto;
	background-color: var(--color-surface-primary-default);
	border: 1px solid var(--color-border-primary-default);
	border-radius: border.$border-radius-medium;
	overflow: hidden;
	box-shadow: var(--color-shadow-elevated);
	transition: width motion.$duration-moderate-01 motion.$easing-productive-standard;

	&.device_desktop {
		width: 100%;
		max-width: 600px;
	}

	&.device_tablet {
		width: 480px;
	}

	&.device_mobile {
		width: 360px;
	}
}

.emailHeader {
	display: flex;
	flex-direction: column;
	gap: layout.$spacing-02;
	padding: layout.$spacing-03 layout.$spacing-04;
	border-bottom: 1px solid var(--color-border-primary-default);
	background-color: var(--color-surface-secondary-default);
}

.emailHeaderRow {
	display: flex;
	align-items: center;
	gap: layout.$spacing-02;
}

.emailLabel {
	font-size: typography.$font-size-sm;
	font-weight: typography.$font-weight-medium;
	color: var(--color-text-secondary-default);
	min-width: 60px;
}

.emailValue {
	font-size: typography.$font-size-sm;
	color: var(--color-text-primary-default);
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
}

.emailBody {
	flex: 1;
	min-height: 300px;
	background-color: var(--color-surface-secondary-default);
}

.emailIframe {
	width: 100%;
	height: 100%;
	min-height: 300px;
	border: none;
	background-color: var(--color-white);
}

// No selection state
.noSelection {
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	gap: layout.$spacing-03;
	height: 100%;
	padding: layout.$spacing-08;
	text-align: center;
	color: var(--color-text-tertiary-default);

	i {
		font-size: typography.$font-size-h1;
		opacity: 0.5;
	}

	h3 {
		margin: 0;
		font-size: typography.$font-size-lg;
		font-weight: typography.$font-weight-semibold;
		color: var(--color-text-secondary-default);
	}

	p {
		margin: 0;
		font-size: typography.$font-size-sm;
		max-width: 200px;
	}
}

// Responsive adjustments
@media (width <= 1440px) {
	.builder {
		grid-template-columns: 240px 1fr 300px;
	}
}

@media (width <= 1280px) {
	.builder {
		grid-template-columns: 220px 1fr 280px;
	}
}

@media (width <= 1024px) {
	.builder {
		grid-template-columns: 1fr;
		grid-template-rows: auto 1fr auto;
	}

	.leftPanel,
	.rightPanel {
		max-height: 300px;
	}

	.header {
		flex-direction: column;
		align-items: stretch;
		gap: layout.$spacing-03;
	}

	.headerContent {
		flex-direction: column;
		align-items: flex-start;
	}

	.headerActions {
		justify-content: space-between;
		width: 100%;
		flex-wrap: wrap;
	}
}

@media (width <= 768px) {
	.header {
		padding: layout.$spacing-04;
	}

	.modeTabs {
		padding: 0 layout.$spacing-04;
	}

	.title {
		font-size: typography.$font-size-lg;
	}

	.headerActions {
		flex-direction: column;
		gap: layout.$spacing-02;

		button {
			width: 100%;
		}
	}

	.deviceSelector {
		width: 100%;
		justify-content: center;
	}

	.builder {
		padding: layout.$spacing-03;
		gap: layout.$spacing-03;
	}

	.leftPanel,
	.rightPanel {
		max-height: 250px;
	}

	.testEmailForm {
		flex-direction: column;
		width: 100%;

		.testEmailInput {
			width: 100%;
		}
	}

	.emailPreview {
		&.device_desktop,
		&.device_tablet {
			width: 100%;
		}
	}
}
