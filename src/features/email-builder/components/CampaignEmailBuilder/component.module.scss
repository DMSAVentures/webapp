@use "@/proto-design-system/mixins" as *;

// Loading animation
@keyframes spin {
	from {
		transform: rotate(0deg);
	}

	to {
		transform: rotate(360deg);
	}
}

.loadingIcon {
	animation: spin 1s linear infinite;
}

.root {
	display: flex;
	flex-direction: column;
	height: 100%;
	background-color: var(--color-surface);
	border-radius: var(--radius-md);
	overflow: hidden;
}

// Header
.header {
	display: flex;
	align-items: center;
	justify-content: space-between;
	gap: var(--space-4);
	padding: var(--space-4);
	background-color: var(--color-surface);
	border-bottom: 1px solid var(--color-border);
}

.headerContent {
	display: flex;
	align-items: center;
	gap: var(--space-3);
	flex: 1;
}

.title {
	margin: 0;
	font-size: var(--font-size-xl);
	font-weight: var(--font-weight-semibold);
	color: var(--color-base-content);
}

.headerActions {
	display: flex;
	align-items: center;
	gap: var(--space-2);
}


.testEmailForm {
	display: flex;
	align-items: center;
	gap: var(--space-1);
}

.testEmailInput {
	width: 200px;
}

.successBanner {
	display: flex;
	align-items: center;
	justify-content: center;
	gap: var(--space-1);
	padding: var(--space-2);
	background-color: var(--color-bg-success-default);
	color: var(--color-text-inverse-default);
	font-size: var(--font-size-sm);
	font-weight: var(--font-weight-medium);

	i {
		font-size: var(--font-size-base);
	}
}

// Tabs wrapper
.tabsWrapper {
	flex-shrink: 0;
	padding: 0 var(--space-4);
	background-color: var(--color-surface);
	border-bottom: 1px solid var(--color-border);
}

// Builder layout (3-column)
.builder {
	display: grid;
	grid-template-columns: 260px 1fr 320px;
	grid-template-rows: 1fr;
	gap: var(--space-3);
	flex: 1;
	min-height: 0; // Important for flex child with overflow
	overflow: hidden;
	padding: var(--space-3);
	background-color: var(--color-base-100);
}

// Panels
.leftPanel,
.rightPanel {
	background-color: var(--color-surface);
	border: 1px solid var(--color-border);
	border-radius: var(--radius-md);
	overflow-y: auto;
	min-height: 0; // Allow shrinking in grid
}

.centerPanel {
	display: flex;
	flex-direction: column;
	gap: var(--space-3);
	overflow-y: auto;
	min-height: 0; // Allow shrinking in grid
}

.rightPanel {
	display: flex;
	flex-direction: column;
	overflow: hidden; // Contain content, child will scroll
}

// Panel mode toggle (Content vs Appearance)
.panelModeToggle {
	padding: var(--space-3);
	border-bottom: 1px solid var(--color-border);
	flex-shrink: 0;
}

// Subject editor
.subjectEditor {
	background-color: var(--color-surface);
	border: 1px solid var(--color-border);
	border-radius: var(--radius-md);
	padding: var(--space-3);
}

// Canvas wrapper
.canvasWrapper {
	display: flex;
	flex-direction: column;
	flex-shrink: 0; // Don't shrink - height based on content
	background-color: var(--color-surface);
	border: 1px solid var(--color-border);
	border-radius: var(--radius-md);
	overflow: hidden;
}

.canvasHeader {
	display: flex;
	align-items: center;
	gap: var(--space-1);
	padding: var(--space-2) var(--space-3);
	background-color: var(--color-base-100);
	border-bottom: 1px solid var(--color-border);
	font-size: var(--font-size-sm);
	font-weight: var(--font-weight-medium);
	color: var(--color-base-content-secondary);

	i {
		font-size: var(--font-size-base);
		color: var(--color-base-content-secondary);
	}
}

.blockCount {
	margin-left: auto;
	font-size: var(--font-size-xs);
	color: var(--color-base-content-tertiary);
}

.canvas {
	display: flex;
	flex-direction: column;
	gap: var(--space-1);
	padding: var(--space-3);
}

.emptyCanvas {
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	gap: var(--space-3);
	padding: var(--space-8);
	color: var(--color-base-content-tertiary);
	text-align: center;
	border: 2px dashed var(--color-border);
	border-radius: var(--radius-md);
	margin: var(--space-2);
	background-color: oklch(from var(--color-info) l c h / 0.03);

	p {
		margin: 0;
		font-size: var(--font-size-sm);
		max-width: 200px;
	}
}

.loadingState {
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	gap: var(--space-3);
	padding: var(--space-8);
	color: var(--color-base-content-tertiary);
	text-align: center;
	flex: 1;
	background-color: var(--color-surface);
	border: 1px solid var(--color-border);
	border-radius: var(--radius-md);

	p {
		margin: 0;
		font-size: var(--font-size-sm);
	}
}

// Preview section
.previewWrapper {
	display: flex;
	flex-direction: column;
	flex: 1; // Take remaining space to show full email preview
	min-height: 300px;
	background-color: var(--color-surface);
	border: 1px solid var(--color-border);
	border-radius: var(--radius-md);
	overflow: hidden;
}

.previewHeader {
	display: flex;
	align-items: center;
	gap: var(--space-1);
	padding: var(--space-2) var(--space-3);
	background-color: var(--color-base-100);
	border-bottom: 1px solid var(--color-border);
	font-size: var(--font-size-sm);
	font-weight: var(--font-weight-medium);
	color: var(--color-base-content-secondary);

	i {
		font-size: var(--font-size-base);
		color: var(--color-base-content-secondary);
	}
}

.emailPreview {
	display: flex;
	flex-direction: column;
	margin: var(--space-3) auto;
	background-color: var(--color-surface);
	border: 1px solid var(--color-border);
	border-radius: var(--radius-md);
	overflow: hidden;
	box-shadow: var(--color-shadow-elevated);
	transition: width var(--duration-normal) var(--ease-out);

	&.device_desktop {
		width: 100%;
		max-width: 600px;
	}

	&.device_tablet {
		width: 480px;
	}

	&.device_mobile {
		width: 360px;
	}
}

.emailHeader {
	display: flex;
	flex-direction: column;
	gap: var(--space-1);
	padding: var(--space-2) var(--space-3);
	border-bottom: 1px solid var(--color-border);
	background-color: var(--color-base-100);
}

.emailHeaderRow {
	display: flex;
	align-items: center;
	gap: var(--space-1);
}

.emailLabel {
	font-size: var(--font-size-sm);
	font-weight: var(--font-weight-medium);
	color: var(--color-base-content-secondary);
	min-width: 60px;
}

.emailValue {
	font-size: var(--font-size-sm);
	color: var(--color-base-content);
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
}

.emailBody {
	flex: 1;
	min-height: 300px;
	background-color: var(--color-base-100);
}

.emailIframe {
	width: 100%;
	height: 100%;
	min-height: 300px;
	border: none;
	background-color: var(--color-white);
}

// No selection state
.noSelection {
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	gap: var(--space-3);
	height: 100%;
	padding: var(--space-6);
	text-align: center;
	color: var(--color-base-content-tertiary);
	background-color: var(--color-base-100);
	margin: var(--space-4);
	border-radius: var(--radius-md);

	h3 {
		margin: 0;
		font-size: var(--font-size-md);
		font-weight: var(--font-weight-semibold);
		color: var(--color-base-content-secondary);
	}

	p {
		margin: 0;
		font-size: var(--font-size-sm);
		max-width: 220px;
		line-height: var(--line-height-normal);
	}
}

// Responsive adjustments
@media (width <= 1440px) {
	.builder {
		grid-template-columns: 240px 1fr 300px;
	}
}

@media (width <= 1280px) {
	.builder {
		grid-template-columns: 220px 1fr 280px;
	}
}

@include breakpoint-down(lg) {
	.builder {
		grid-template-columns: 1fr;
		grid-template-rows: auto 1fr auto;
	}

	.leftPanel,
	.rightPanel {
		max-height: 300px;
	}

	.header {
		flex-direction: column;
		align-items: stretch;
		gap: var(--space-2);
	}

	.headerContent {
		flex-direction: column;
		align-items: flex-start;
	}

	.headerActions {
		justify-content: space-between;
		width: 100%;
		flex-wrap: wrap;
	}
}

@include breakpoint-down(md) {
	.header {
		padding: var(--space-3);
	}

	.tabsWrapper {
		padding: 0 var(--space-3);
	}

	.title {
		font-size: var(--font-size-lg);
	}

	.headerActions {
		flex-direction: column;
		gap: var(--space-1);

		button {
			width: 100%;
		}
	}


	.builder {
		padding: var(--space-2);
		gap: var(--space-2);
	}

	.leftPanel,
	.rightPanel {
		max-height: 250px;
	}

	.testEmailForm {
		flex-direction: column;
		width: 100%;

		.testEmailInput {
			width: 100%;
		}
	}

	.emailPreview {
		&.device_desktop,
		&.device_tablet {
			width: 100%;
		}
	}
}
